---
title: "Preguntas"
output: html_document
date: "2026-02-14"
---

```{r setup, include=FALSE}
library(nortest)
library(dplyr)
library(janitor)
library(knitr)
library(kableExtra)
library(ggplot2)
library(corrplot)

# Cargar datos
tryCatch({
  df <- read.csv("datos_combinados.csv") %>% clean_names()
}, error = function(e) {
  stop("No se encuentra el archivo. Verifica que 'datos_combinados.csv' esté en la misma carpeta que este script.")
})
```

##1 Los divorcios se concentran en pocos departamentos

```{r}
if ("depocu" %in% names(df)) {
  tab_dep <- as.data.frame(table(df$depocu, useNA="no"))
  names(tab_dep) <- c("depocu","n")
  tab_dep <- tab_dep[order(-tab_dep$n), ]
  tab_dep$pct <- round(100 * tab_dep$n / sum(tab_dep$n), 2)
  tab_dep$acum_pct <- round(cumsum(tab_dep$pct), 2)

  knitr::kable(head(tab_dep, 10), caption="Top 10 departamentos por divorcios (depocu)")

  plot(tab_dep$acum_pct, type="l", xlab="Ranking de departamentos", ylab="% acumulado",
       main="% acumulado de divorcios por departamento")
  abline(h=50, lty=2); abline(h=80, lty=2)
} else {
  cat("La columna depocu no existe en el dataset.\n")
}

```

##2 Hay meses con más divorcios

```{r}
if ("mesocu" %in% names(df)) {
  tab_mes <- as.data.frame(table(df$mesocu, useNA="no"))
  names(tab_mes) <- c("mesocu","n")
  tab_mes$mesocu <- as.integer(as.character(tab_mes$mesocu))

  ggplot(tab_mes, aes(x=factor(mesocu), y=n)) +
    geom_col() +
    labs(title="Divorcios por mes de ocurrencia", x="Mes", y="Número de divorcios")
} else {
  cat("La columna mesocu no existe en el dataset.\n")
}

```

##3 La edad del esposo y la esposa están fuertemente relacionadas 

```{r}
if (all(c("edadhom","edadmuj") %in% names(df))) {
  df_ed <- df[df$edadhom >= 18 & df$edadhom <= 100 &
                df$edadmuj >= 18 & df$edadmuj <= 100, ]
  df_ed <- df_ed[is.finite(df_ed$edadhom) & is.finite(df_ed$edadmuj), ]

  r <- cor(df_ed$edadhom, df_ed$edadmuj, use="complete.obs")
  cat("Correlación edadhom-edadmuj:", round(r, 3), "\n\n")

  ggplot(df_ed, aes(x=edadhom, y=edadmuj)) +
    geom_point(alpha=0.25) +
    geom_smooth(method="lm") +
    labs(title="Edad del esposo vs Edad de la esposa", x="Edad esposo", y="Edad esposa")
}

```


##4
```{r}
df_h <- df[df$edadhom >= 18 & df$edadhom <= 100, ]
df_h$rango_h <- cut(df_h$edadhom, breaks=c(18,25,35,45,55,65,100), right=FALSE)

df_m <- df[df$edadmuj >= 18 & df$edadmuj <= 100, ]
df_m$rango_m <- cut(df_m$edadmuj, breaks=c(18,25,35,45,55,65,100), right=FALSE)

tab_h <- as.data.frame(table(df_h$rango_h)); names(tab_h) <- c("rango","n"); tab_h$grupo <- "Esposo"
tab_m <- as.data.frame(table(df_m$rango_m)); names(tab_m) <- c("rango","n"); tab_m$grupo <- "Esposa"

tab <- rbind(tab_h, tab_m)

ggplot(tab, aes(x=rango, y=n, fill=grupo)) +
  geom_col(position="dodge") +
  labs(title="Divorcios por rango de edad: esposo vs esposa", x="Rango de edad", y="Casos")

```

## apoyo 3
```{r}
df_ed <- df[df$edadhom >= 18 & df$edadhom <= 100 &
              df$edadmuj >= 18 & df$edadmuj <= 100, ]

df_ed$dif_edad <- abs(df_ed$edadhom - df_ed$edadmuj)

hist(df_ed$dif_edad, breaks=30, col="lightgray",
     main="Diferencia de edad |esposo - esposa|", xlab="Años")

cat("Proporción dif<=5:", round(mean(df_ed$dif_edad <= 5, na.rm=TRUE), 3), "\n")
cat("Proporción dif<=10:", round(mean(df_ed$dif_edad <= 10, na.rm=TRUE), 3), "\n")

```


##5

```{r}
## B) ¿Quién es mayor con más frecuencia?
# Supuesto: edadhom > edadmuj en la mayoría de casos

if (all(c("edadhom","edadmuj") %in% names(df))) {

  # Filtrar edades válidas (evita 999 y valores raros)
  df_ed <- df[df$edadhom >= 18 & df$edadhom <= 100 &
                df$edadmuj >= 18 & df$edadmuj <= 100, ]
  df_ed <- df_ed[is.finite(df_ed$edadhom) & is.finite(df_ed$edadmuj), ]

  # Clasificación de comparación
  df_ed$quien_mayor <- ifelse(df_ed$edadhom > df_ed$edadmuj, "Esposo mayor",
                        ifelse(df_ed$edadhom < df_ed$edadmuj, "Esposa mayor",
                               "Misma edad"))

  # Tabla de frecuencias y porcentajes
  tab <- as.data.frame(table(df_ed$quien_mayor))
  names(tab) <- c("Categoria","n")
  tab$pct <- round(100 * tab$n / sum(tab$n), 2)

  knitr::kable(tab, caption="¿Quién es mayor con más frecuencia? (edades válidas)")

  # Grafica de barras:
  
  ggplot(tab, aes(x = reorder(Categoria, -n), y = n, fill = Categoria)) +
  geom_col(width = 0.7, alpha = 0.95, show.legend = FALSE) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "¿Quién es mayor con más frecuencia en los divorcios?",
       x = "Categoría", y = "Casos") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))

}

```


